<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Steve</title>
    <script src="phaser.min.js"></script>
    <style>
        * {
            background-color: gray;
            margin: 0;
            padding: 0;
        }

    </style>
</head>

<body>
    <script>
        var game = new Phaser.Game(800, 640, Phaser.AUTO);

        var menuState = {
            preload: function() {

            },

            create: function() {

            },

            update: function() {

            }
        };

        var gameState = {
            preload: function() {
                game.load.tilemap('level1', 'level1.json', null, Phaser.Tilemap.TILED_JSON);
                game.load.image('grassTileset', 'grassTileset.png');
                game.load.spritesheet('steve', 'steve.png', 28, 58);
                game.load.spritesheet('coin', 'coin.png', 16, 16);
            },

            create: function() {
                game.physics.startSystem(Phaser.Physics.ARCADE);
                game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
                
                // add tilemap and tilesets to game
                this.map = game.add.tilemap('level1');
                this.map.addTilesetImage('grassTileset');
                
                // create map layers
                this.mapSky = this.map.createLayer('sky');
                this.mapGround = this.map.createLayer('ground');
                this.mapPlatforms = this.map.createLayer('platforms');
                this.mapCollectables = this.map.createLayer('collectables');
                
                // add collision for tilemap
                this.map.setCollisionBetween(1, 11, true, 'ground');
                this.map.setCollisionBetween(25, 28, true, 'platforms');
                
                // add player 'steve' to game
                this.player = game.add.sprite(50, game.world.centerY, 'steve');
                this.player.scale.setTo(0.5, 0.5);
                this.player.anchor.setTo(0.5);
                // enable physics for player
                game.physics.enable(this.player);
                this.player.body.gravity.y = 800;
                this.player.body.bounce.y = 0.2;
                this.player.body.drag.x = 2000;
                this.player.body.collideWorldBounds = true;
                // add player animations
                this.player.animations.add('walk', [1, 2, 3, 2], 5, true);
                
                // add collectable coins to game
                this.coins = game.add.group();
                this.coins.enableBody = true;                
                this.map.createFromObjects('collectables', 15, 'coin', 0, true, false, this.coins);                
                this.coins.callAll('animations.add', 'animations', 'spin', [0, 1, 2, 3, 4, 5, 6, 7, 8], 6, true);
                this.coins.callAll('animations.play', 'animations', 'spin');
                
                // create cursor keys for basic controls
                this.cursors = game.input.keyboard.createCursorKeys();
                
                this.PLAYER_VELOCITY = 200;
            },

            update: function() {
                // make player collide with tiles
                game.physics.arcade.collide(this.player, [this.mapGround, this.mapPlatforms]);
                // call pickUpCoin when player is overlapping with a coin object
                game.physics.arcade.overlap(this.player, this.coins, this.pickUpCoin, null, this);
                
                // basic controls for player, LEFT and RIGHT for horizontal movement, UP to jump
                if (this.cursors.left.isDown) {
                    this.player.scale.setTo(-0.5, 0.5);
                    this.player.animations.play('walk');
                    this.player.body.velocity.x = -this.PLAYER_VELOCITY;
                } else if (this.cursors.right.isDown) {
                    this.player.scale.setTo(0.5, 0.5);
                    this.player.animations.play('walk');
                    this.player.body.velocity.x = this.PLAYER_VELOCITY;
                } else {
                    this.player.animations.stop('walk');
                    this.player.frame = 0;
                    this.player.body.velocity.x = 0;
                }
                if (this.cursors.up.isDown && this.player.body.onFloor()) {
                    this.player.body.velocity.y = -300;
                }
            },
            
            pickUpCoin: function(player, coin) {
                coin.kill();
            }
        };

        game.state.add('menu', menuState);
        game.state.add('game', gameState);
        game.state.start('game');

    </script>
</body>

</html>
